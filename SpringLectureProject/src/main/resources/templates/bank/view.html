<!doctype html>
<html lang="hu" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MNB árfolyamok – Eredmények</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/arfolyam.css">
</head>
<body class="is-preload">
<div id="wrapper">
    <div id="main">
        <div class="inner">

            <header id="header">
                <a href="/" class="logo"><strong>Magyar Nemzeti Bank</strong> • Devizakereskedő kliens</a>
            </header>

            <header class="major">
                <h1>Eredmények</h1>


                <p>
                    DEVIZA:
                    <span>HUF</span>
                    → <span th:text="${dto != null && dto.selectedCurrency != null ? dto.selectedCurrency : '—'}">EUR</span>
                </p>

                <p>
                    IDŐINTERVALLUM:
                    <span th:text="${dto != null && dto.startDate != null ? dto.startDate : '—'}">2025-11-01</span>
                    → <span th:text="${dto != null && dto.endDate != null ? dto.endDate : '—'}">2025-11-07</span>
                </p>
            </header>


            <section>
                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Dátum</th>
                            <th>Deviza</th>
                            <th>Árfolyam</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="r : ${data}">
                            <td th:text="${r.date}">2025-11-04</td>
                            <td th:text="${dto != null and dto.selectedCurrency != null ? dto.selectedCurrency : ''}">EUR</td>
                            <td th:text="${#strings.replace(#numbers.formatDecimal(r.currency, 1, 2), '.', ',')}">
                                386,42
                            </td>

                        </tr>
                        </tbody>
                    </table>
                </div>

                <div style="height:420px">
                    <canvas id="exchangeChart"></canvas>
                </div>

                <ul class="actions" style="margin-top:1.25rem">
                    <li><a th:href="@{/mnb}" class="button">Vissza</a></li>
                </ul>
            </section>
        </div>
    </div>
</div>

<script src="/js/jquery.min.js"></script>
<script src="/js/browser.min.js"></script>
<script src="/js/breakpoints.min.js"></script>
<script src="/js/util.js"></script>
<script src="/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    // Thymeleaf-ből jövő adatok
    const chartLabelsRaw = /*[[${chartLabels}]]*/ [];
    const chartDataRaw   = /*[[${chartData}]]*/ [];

    const chartLabels = Array.isArray(chartLabelsRaw) ? chartLabelsRaw : [];
    const chartData = (Array.isArray(chartDataRaw) ? chartDataRaw : [])
      .map(v => {
        const n = Number(String(v).replace(',', '.'));
        return Number.isFinite(n) ? n : null;
      });

    // CSS változóból kérjük le az akcent színt
    const accentHex = getComputedStyle(document.documentElement)
      .getPropertyValue('--accent-color').trim();

    function hexToRgba(hex, alpha=1){
      const m = hex.replace('#','');
      const bigint = parseInt(m.length===3 ? m.split('').map(x=>x+x).join('') : m, 16);
      const r = (bigint >> 16) & 255, g = (bigint >> 8) & 255, b = bigint & 255;
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    const ctx = document.getElementById('exchangeChart');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Árfolyam',
          data: chartData,
          fill: true,
          tension: 0.3,
          pointRadius: 3,
          borderWidth: 2,
          borderColor: accentHex,
          backgroundColor: hexToRgba(accentHex, 0.22),
          pointBackgroundColor: accentHex,
          pointBorderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
</script>

</body>
</html>
